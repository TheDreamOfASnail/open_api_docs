<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="canonical" href="http://api-docs.convertlab.com/member/"> 
    <link rel="shortcut icon" href="../img/favicon.ico">
    <title>Api接口 - Convertlab 文档中心</title>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <link href="../test/css/print.css" rel="stylesheet">

    
</head>
<body>
    <div class="navbar navbar-default" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://www.convertlab.com/">Convertlab 文档中心</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                
                  <li class="pull-left">
                    
                    <a href="..">OpenAPI V1</a>
                    
                  </li>
                
                  <li class="pull-left">
                    
                    <a href="../track/jscollection/">前端埋点</a>
                    
                  </li>
                
                  <li class="pull-left">
                    
                    <a href="../webhook/webhook/">Webhook</a>
                    
                  </li>
                
                  <li class="pull-left active">
                    
                    <a href="./">会员</a>
                    
                  </li>
                
                  <!--<li class="pull-left">
                    
                    <a href="/test/">TRY IT</a>
                    
                  </li>-->
                </ul>
            
        </div>
    </div>
</div>
    <div class="container main">
       <!--   <div class="toolbar clearfix">
  <ol class="breadcrumb pull-left">
    <li><a href="">文档</a></li>
    <li>Api接口</li>
  </ol>

  
    
      <a href="https://github.com/xsio/open_api_docs/" class="github-edit pull-right"><i class="fa fa-github"></i> Edit on GitHub</a>
    
  

</div> -->
        <div class="col-md-3"><div class="bs-sidebar hidden-print" data-spy="affix" data-offset-top="80" role="complementary">
    <ul class="nav bs-sidenav">
     
      
        
      

    
      
        
      

    
      
        
      

    
      
        
          

              <li class="active">
                <a class="itm-l1" href="./">Api接口</a>
                
                  <ul class="nav">
                  
                    <li class="active "><a href="#_1">会员模型</a></li>
                    
                  
                    <li class=""><a href="#_2">会员身份模型</a></li>
                    
                  
                    <li class=""><a href="#1">1. 查看全部会员</a></li>
                    
                  
                    <li class=""><a href="#2">2. 创建会员和会员身份</a></li>
                    
                  
                    <li class=""><a href="#3">3. 查看一个会员</a></li>
                    
                  
                    <li class=""><a href="#4">4. 修改一个会员</a></li>
                    
                  
                    <li class=""><a href="#5">5. 修改会员等级</a></li>
                    
                  
                    <li class=""><a href="#6">6. 绑定会员身份</a></li>
                    
                  
                    <li class=""><a href="#7">7. 根据会员身份查找会员</a></li>
                    
                  
                    <li class=""><a href="#8">8. 根据会员身份列表查找会员</a></li>
                    
                  
                    <li class=""><a href="#9">9. 修改会员手机号</a></li>
                    
                  
                    <li class=""><a href="#10">10. 查看会员等级设置</a></li>
                    
                  
                    <li class=""><a href="#11-api">11. 订单Api</a></li>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#111">11.1. 创建订单</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#112">11.2. 取消订单</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#113">11.3. 退单</a></li>
                      </ul>
                    
                  
                    <li class=""><a href="#12">12. 会员注册推送设备信息</a></li>
                    
                  
                    <li class=""><a href="#13-api">13. 优惠券Api</a></li>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#_3">模型</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#131coupon">13.1.获取所有coupon</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#132couponidcoupon">13.2.根据couponId获取coupon</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#133couponchannelcoupon">13.3.根据couponChannel获取coupon</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#134">13.4.领券</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#135couponcodemembershipcoupon">13.5.根据couponCode获取membershipCoupon</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#136membershipidmembershipcoupon">13.6.根据membershipId获取membershipCoupon列表</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#137">13.7.核销</a></li>
                      </ul>
                    
                  
                  </ul>
                
              </li>

          
        
      

    
    </ul>
</div></div>
        <div class="col-md-9 content-body" role="main">
             

<h1>Api接口</h1>

<h2 id="_1">会员模型</h2>
<p>DM Hub为<strong>会员</strong>内置一些比较通用的会员属性，这些属性的名称和类型如下表所示：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>界面显示名称</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>会员ID</td>
<td>数字</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>姓名</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>familyName</td>
<td>姓</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>givenName</td>
<td>名</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>customerId</td>
<td>客户id</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>membershipCode</td>
<td>会员号</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>idCard</td>
<td>​会员身份证</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>address</td>
<td>​详细地址</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>educationBackgro</td>
<td>教育背景</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>img</td>
<td>用户头像</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>gender</td>
<td>性别</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>mobile</td>
<td>手机号码</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>email</td>
<td>邮箱</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>birthday</td>
<td>生日</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>dateJoin</td>
<td>注册时间</td>
<td>日期时间</td>
<td></td>
</tr>
<tr>
<td>createMethod</td>
<td>创建方式</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>createChannel</td>
<td>创建渠道</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>industry</td>
<td>公司行业</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>income</td>
<td>收入</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>balance</td>
<td>储值余额</td>
<td>数字</td>
<td></td>
</tr>
<tr>
<td>referrer</td>
<td>推广人</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>lastUpdated</td>
<td>最后更新时间</td>
<td>日期时间</td>
<td></td>
</tr>
<tr>
<td>level</td>
<td>会员等级</td>
<td>Json对象</td>
<td></td>
</tr>
<tr>
<td>point</td>
<td>会员积分</td>
<td>数字</td>
<td></td>
</tr>
<tr>
<td>source</td>
<td>来源</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>contentName</td>
<td>来源内容</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>country</td>
<td>国家</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>province</td>
<td>省</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>city</td>
<td>市</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>county</td>
<td>区县</td>
<td>文本</td>
<td></td>
</tr>
<tr>
<td>dateCreated</td>
<td>系统创建时间</td>
<td>日期时间</td>
<td></td>
</tr>
</tbody>
</table>
<p>除了系统内置的会员属性外，您还可以增加自定义属性。<br />
登录DM Hub，在会员属性设置页面中，可增加自定义会员属性。包括属性名、属性代码、属性类型等。
自定义属性的代码以"c_"作为前缀。</p>
<h2 id="_2">会员身份模型</h2>
<p>DM Hub内置了几个身份类型</p>
<table>
<thead>
<tr>
<th>内置身份类型</th>
<th>含义</th>
<th>是否唯一</th>
</tr>
</thead>
<tbody>
<tr>
<td>mobile</td>
<td>手机号</td>
<td>是</td>
</tr>
<tr>
<td>wechat</td>
<td>微信的openid</td>
<td>否</td>
</tr>
<tr>
<td>wechat-unionid</td>
<td>微信的unionid</td>
<td>否</td>
</tr>
<tr>
<td>taobao-account</td>
<td>淘宝账号</td>
<td>否</td>
</tr>
</tbody>
</table>
<p>另外用户可以在DM Hub会员身份设置中自定义会员身份类型，用户定义的身份类型以"c_"作为前缀。</p>
<h2 id="1">1. 查看全部会员</h2>
<ul>
<li>
<p>HTTP请求方式: <code>GET</code></p>
</li>
<li>
<p><code>/loyalty/v1/membership?access_token={access_token}</code></p>
</li>
<li>
<p>Response</p>
</li>
</ul>
<pre><code class="json">{
    &quot;rows&quot;: [
        {
            &quot;address&quot;: null,
            &quot;balance&quot;: null,
            &quot;birthday&quot;: &quot;1988-01-01&quot;,
            &quot;createChannel&quot;: null,
            &quot;createMethod&quot;: &quot;外部系统导入&quot;,
            &quot;customerId&quot;: null,
            &quot;dateCreated&quot;: &quot;2017-10-31T03:07:47Z&quot;,
            &quot;dateJoin&quot;: &quot;2017-10-31T03:07:47Z&quot;,
            &quot;educationBackgro&quot;: null,
            &quot;email&quot;: null,
            &quot;familyName&quot;: null,
            &quot;gender&quot;: 1,
            &quot;id&quot;: 1,
            &quot;idCard&quot;: null,
            &quot;img&quot;: null,
            &quot;income&quot;: null,
            &quot;industry&quot;: null,
            &quot;givenName&quot;: null,
            &quot;lastUpdated&quot;: &quot;2017-10-31T03:07:47Z&quot;,
            &quot;level&quot;:  {
                        &quot;priority&quot;: 0,        //等级所代表的层级，0为最低，向上递增
                        &quot;name&quot;: &quot;青铜会员&quot;,
                        &quot;id&quot;: 422
                        },
            &quot;membershipCode&quot;: null,
            &quot;mobile&quot;: null,
            &quot;name&quot;: &quot;test&quot;,
            &quot;point&quot;: 0,
            &quot;source&quot;: null,                 //新增字段
            &quot;contentName&quot;: null,            //新增字段
            &quot;campaignId&quot;: null,             //新增字段
            &quot;country&quot;: null,                //新增字段
            &quot;province&quot;: null,               //新增字段
            &quot;city&quot;: null,                   //新增字段
            &quot;county&quot;: null                  //新增字段
        }
    ]
}
</code></pre>

<h2 id="2">2. 创建会员和会员身份</h2>
<p>创建会员时需要同时包含会员身份的信息，即membership和identities两项都不能为空值。  </p>
<ul>
<li>
<p>HTTP请求方式: <code>POST</code></p>
</li>
<li>
<p><code>/loyalty/v1/membershipAndIdentities?access_token={access_token}</code></p>
</li>
<li>
<p>Request Payload</p>
</li>
</ul>
<pre><code class="json">{
    &quot;membership&quot;: {
        &quot;name&quot;: &quot;test&quot;,
        &quot;cm_test2&quot;: true,
        &quot;gender&quot;: 1,
        &quot;birthday&quot;: &quot;1988-01-01&quot;,
        &quot;cm_test3&quot;: &quot;true&quot;
    },
    &quot;identities&quot;: [
        {
            &quot;type&quot;: &quot;wechat&quot;,
            &quot;value&quot;: &quot;123456&quot;,
            &quot;name&quot;: &quot;cm_test&quot;
        }
    ]
}
</code></pre>

<ul>
<li>Response</li>
</ul>
<pre><code class="json">{
    &quot;address&quot;: null,
    &quot;balance&quot;: null,
    &quot;birthday&quot;: &quot;1988-01-01&quot;,
    &quot;createChannel&quot;: null,
    &quot;createMethod&quot;: &quot;外部系统导入&quot;,
    &quot;customerId&quot;: null,
    &quot;dateCreated&quot;: &quot;2017-10-31T03:21:09Z&quot;,
    &quot;dateJoin&quot;: &quot;2017-10-31T03:21:09Z&quot;,
    &quot;educationBackgro&quot;: null,
    &quot;email&quot;: null,
    &quot;familyName&quot;: null,
    &quot;gender&quot;: 1,
    &quot;id&quot;: 3,
    &quot;idCard&quot;: null,
    &quot;img&quot;: null,
    &quot;income&quot;: null,
    &quot;industry&quot;: null,
    &quot;givenName&quot;: null,
    &quot;lastUpdated&quot;: &quot;2017-10-31T03:21:09Z&quot;,
    &quot;level&quot;: {
        &quot;priority&quot;: 0,
        &quot;name&quot;: &quot;青铜会员&quot;,
        &quot;id&quot;: 422
    },
    &quot;membershipCode&quot;: null,
    &quot;mobile&quot;: null,
    &quot;name&quot;: &quot;test&quot;,
    &quot;point&quot;: 0,
    &quot;source&quot;: null,
    &quot;contentName&quot;: null,
    &quot;campaignId&quot;: null,
    &quot;country&quot;: null,
    &quot;province&quot;: null,
    &quot;city&quot;: null,
    &quot;county&quot;: null
}
</code></pre>

<h2 id="3">3. 查看一个会员</h2>
<ul>
<li>
<p>HTTP请求方式: <code>GET</code></p>
</li>
<li>
<p><code>/loyalty/v1/membership/${membershipId}?access_token={access_token}</code></p>
</li>
<li>
<p>Response</p>
</li>
</ul>
<pre><code class="json">{
    &quot;address&quot;: null,
    &quot;balance&quot;: null,
    &quot;birthday&quot;: &quot;1988-01-01&quot;,
    &quot;createChannel&quot;: null,
    &quot;createMethod&quot;: &quot;外部系统导入&quot;,
    &quot;customerId&quot;: null,
    &quot;dateCreated&quot;: &quot;2017-10-31T03:07:47Z&quot;,
    &quot;dateJoin&quot;: &quot;2017-10-31T03:07:47Z&quot;,
    &quot;educationBackgro&quot;: null,
    &quot;email&quot;: null,
    &quot;familyName&quot;: null,
    &quot;gender&quot;: 1,
    &quot;id&quot;: 1,
    &quot;idCard&quot;: null,
    &quot;img&quot;: null,
    &quot;income&quot;: null,
    &quot;industry&quot;: null,
    &quot;givenName&quot;: null,
    &quot;lastUpdated&quot;: &quot;2017-10-31T03:07:47Z&quot;,
    &quot;level&quot;: {
        &quot;priority&quot;: 0,
        &quot;name&quot;: &quot;青铜会员&quot;,
        &quot;id&quot;: 422
    },
    &quot;membershipCode&quot;: null,
    &quot;mobile&quot;: null,
    &quot;name&quot;: &quot;test&quot;,
    &quot;point&quot;: 0,
    &quot;source&quot;: null,
    &quot;contentName&quot;: null,
    &quot;campaignId&quot;: null,
    &quot;country&quot;: null,
    &quot;province&quot;: null,
    &quot;city&quot;: null,
    &quot;county&quot;: null
}
</code></pre>

<h2 id="4">4. 修改一个会员</h2>
<ul>
<li>
<p>HTTP请求方式: <code>PUT</code></p>
</li>
<li>
<p><code>/loyalty/v1/membership/${membershipId}?access_token={access_token}</code></p>
</li>
<li>
<p>Request Payload</p>
</li>
</ul>
<pre><code class="json">{
    &quot;name&quot;: &quot;test1&quot;,
    &quot;gender&quot;: 0,
    &quot;email&quot;: &quot;111@test.com&quot;
}
</code></pre>

<ul>
<li>Response</li>
</ul>
<pre><code class="json">{
    &quot;address&quot;: null,
    &quot;balance&quot;: null,
    &quot;birthday&quot;: &quot;1988-01-01&quot;,
    &quot;createChannel&quot;: null,
    &quot;createMethod&quot;: &quot;外部系统导入&quot;,
    &quot;customerId&quot;: null,
    &quot;dateCreated&quot;: &quot;2017-10-31T03:07:47Z&quot;,
    &quot;dateJoin&quot;: &quot;2017-10-31T03:07:47Z&quot;,
    &quot;educationBackgro&quot;: null,
    &quot;email&quot;: &quot;111@test.com&quot;,
    &quot;familyName&quot;: null,
    &quot;gender&quot;: 0,
    &quot;id&quot;: 1,
    &quot;idCard&quot;: null,
    &quot;img&quot;: null,
    &quot;income&quot;: null,
    &quot;industry&quot;: null,
    &quot;givenName&quot;: null,
    &quot;lastUpdated&quot;: &quot;2017-10-31T05:56:57Z&quot;,
    &quot;level&quot;: {
        &quot;priority&quot;: 0,
        &quot;name&quot;: &quot;青铜会员&quot;,
        &quot;id&quot;: 422
    }, 
    &quot;membershipCode&quot;: null,
    &quot;mobile&quot;: null,
    &quot;name&quot;: &quot;test1&quot;,
    &quot;point&quot;: 0,
    &quot;source&quot;: null,
    &quot;contentName&quot;: null,
    &quot;campaignId&quot;: null,
    &quot;country&quot;: null,
    &quot;province&quot;: null,
    &quot;city&quot;: null,
    &quot;county&quot;: null
}
</code></pre>

<h2 id="5">5. 修改会员等级</h2>
<ul>
<li>
<p>HTTP请求方式: <code>PUT</code></p>
</li>
<li>
<p><code>/loyalty/v1/membership/${membershipId}/level?access_token={access_token}</code></p>
</li>
<li>
<p>Request Payload</p>
</li>
</ul>
<pre><code class="json">
    {
        &quot;level&quot;: 8
    }

</code></pre>

<ul>
<li>Response</li>
</ul>
<pre><code class="json">
    {
            &quot;dateCreated&quot;: &quot;2017-10-31T06:54:01Z&quot;,
            &quot;id&quot;: 3,
            &quot;lastUpdated&quot;: &quot;2017-10-31T06:54:01Z&quot;,
            &quot;levelType&quot;: 0,
            &quot;levelUpdateStatus&quot;: 1,
            &quot;membershipId&quot;: 1,
            &quot;newLevel&quot;: 8,
            &quot;oldLevel&quot;: 0,
            &quot;remark&quot;: null,
            &quot;rule&quot;: null,
            &quot;tenantId&quot;: 11
    }

</code></pre>

<h2 id="6">6. 绑定会员身份</h2>
<ul>
<li>
<p>HTTP请求方式: <code>POST</code></p>
</li>
<li>
<p><code>/loyalty/v1/membership/${membershipId}/bindIdentity?access_token={access_token}</code></p>
</li>
<li>
<p>Request Payload</p>
</li>
</ul>
<pre><code class="json">[
    {
        &quot;type&quot;: &quot;wechat&quot;,
        &quot;value&quot;: &quot;666&quot;,
        &quot;name&quot;: &quot;cm_test1&quot;
    }
]
</code></pre>

<ul>
<li>Response</li>
</ul>
<pre><code class="json">[
    {
        &quot;name&quot;: &quot;cm_test1&quot;,
        &quot;type&quot;: &quot;wechat&quot;,
        &quot;value&quot;: &quot;666&quot;
    }
]
</code></pre>

<h2 id="7">7. 根据会员身份查找会员</h2>
<ul>
<li>
<p>HTTP请求方式: <code>GET</code></p>
</li>
<li>
<p><code>/loyalty/v1/membershipService/getMembershipByIdentity?access_token={access_token}&amp;type={identityType}&amp;value={identityValue}</code></p>
</li>
<li>
<p>Response</p>
</li>
</ul>
<pre><code class="json">{
    &quot;identities&quot;: [
        {
            &quot;name&quot;: &quot;cm_test2&quot;,
            &quot;type&quot;: &quot;wechat&quot;,
            &quot;value&quot;: &quot;1111111111&quot;
        }
    ],
    &quot;membership&quot;: {
        &quot;address&quot;: null,
        &quot;balance&quot;: null,
        &quot;birthday&quot;: &quot;1988-01-01&quot;,
        &quot;createChannel&quot;: null,
        &quot;createMethod&quot;: &quot;外部系统导入&quot;,
        &quot;customerId&quot;: null,
        &quot;dateCreated&quot;: &quot;2017-10-31T03:07:47Z&quot;,
        &quot;dateJoin&quot;: &quot;2017-10-31T03:07:47Z&quot;,
        &quot;educationBackgro&quot;: null,
        &quot;email&quot;: &quot;111@test.com&quot;,
        &quot;familyName&quot;: null,
        &quot;gender&quot;: 0,
        &quot;id&quot;: 1,
        &quot;idCard&quot;: null,
        &quot;img&quot;: null,
        &quot;income&quot;: null,
        &quot;industry&quot;: null,
        &quot;givenName&quot;: null,
        &quot;lastUpdated&quot;: &quot;2017-10-31T05:56:57Z&quot;,
        &quot;level&quot;: {
            &quot;priority&quot;: 0,
            &quot;name&quot;: &quot;青铜会员&quot;,
            &quot;id&quot;: 422
        }, 
        &quot;membershipCode&quot;: null,
        &quot;mobile&quot;: null,
        &quot;name&quot;: &quot;test1&quot;,
        &quot;point&quot;: 0,
        &quot;source&quot;: null,
        &quot;contentName&quot;: null,
        &quot;campaignId&quot;: null,
        &quot;country&quot;: null,
        &quot;province&quot;: null,
        &quot;city&quot;: null,
        &quot;county&quot;: null
    }
}
</code></pre>

<h2 id="8">8. 根据会员身份列表查找会员</h2>
<ul>
<li>
<p>HTTP请求方式: <code>POST</code></p>
</li>
<li>
<p><code>/loyalty/v1/membershipService/listMembershipByIdentities?access_token={access_token}</code></p>
</li>
<li>
<p>Request Payload</p>
</li>
</ul>
<pre><code class="json">[
    {
        &quot;type&quot;: &quot;wechat&quot;,
        &quot;value&quot;: &quot;666&quot;
    },
    {
        &quot;type&quot;: &quot;wechat&quot;,
        &quot;value&quot;: &quot;333&quot;
    }
]
</code></pre>

<ul>
<li>Response</li>
</ul>
<pre><code class="json">{
    &quot;rows&quot;: [
        {
            &quot;identities&quot;: [
                {
                    &quot;name&quot;: &quot;cm_test2&quot;,
                    &quot;type&quot;: &quot;wechat&quot;,
                    &quot;value&quot;: &quot;1111111111&quot;
                }
            ],
            &quot;membership&quot;: {
                &quot;address&quot;: null,
                &quot;balance&quot;: null,
                &quot;birthday&quot;: &quot;1988-01-01&quot;,
                &quot;createChannel&quot;: null,
                &quot;createMethod&quot;: &quot;外部系统导入&quot;,
                &quot;customerId&quot;: null,
                &quot;dateCreated&quot;: &quot;2017-10-31T03:07:47Z&quot;,
                &quot;dateJoin&quot;: &quot;2017-10-31T03:07:47Z&quot;,
                &quot;educationBackgro&quot;: null,
                &quot;email&quot;: &quot;111@test.com&quot;,
                &quot;familyName&quot;: null,
                &quot;gender&quot;: 0,
                &quot;id&quot;: 1,
                &quot;idCard&quot;: null,
                &quot;img&quot;: null,
                &quot;income&quot;: null,
                &quot;industry&quot;: null,
                &quot;givenName&quot;: null,
                &quot;lastUpdated&quot;: &quot;2017-10-31T05:56:57Z&quot;,
                &quot;level&quot;: {
                    &quot;priority&quot;: 0,
                    &quot;name&quot;: &quot;青铜会员&quot;,
                    &quot;id&quot;: 422
                }, 
                &quot;membershipCode&quot;: null,
                &quot;mobile&quot;: null,
                &quot;name&quot;: &quot;test1&quot;,
                &quot;point&quot;: 0,
                &quot;source&quot;: null,
                &quot;contentName&quot;: null,
                &quot;campaignId&quot;: null,
                &quot;country&quot;: null,
                &quot;province&quot;: null,
                &quot;city&quot;: null,
                &quot;county&quot;: null
            }
        },
        {
            &quot;identities&quot;: [
                {
                    &quot;name&quot;: &quot;cm_test2&quot;,
                    &quot;type&quot;: &quot;wechat&quot;,
                    &quot;value&quot;: &quot;333&quot;
                }
            ],
            &quot;membership&quot;: {
                &quot;address&quot;: null,
                &quot;balance&quot;: null,
                &quot;birthday&quot;: &quot;1988-01-01&quot;,
                &quot;createChannel&quot;: null,
                &quot;createMethod&quot;: &quot;外部系统导入&quot;,
                &quot;customerId&quot;: null,
                &quot;dateCreated&quot;: &quot;2017-10-31T03:21:09Z&quot;,
                &quot;dateJoin&quot;: &quot;2017-10-31T03:21:09Z&quot;,
                &quot;educationBackgro&quot;: null,
                &quot;email&quot;: null,
                &quot;familyName&quot;: null,
                &quot;gender&quot;: 1,
                &quot;id&quot;: 3,
                &quot;idCard&quot;: null,
                &quot;img&quot;: null,
                &quot;income&quot;: null,
                &quot;industry&quot;: null,
                &quot;givenName&quot;: null,
                &quot;lastUpdated&quot;: &quot;2017-10-31T03:21:09Z&quot;,
                &quot;level&quot;: {
                    &quot;priority&quot;: 0,
                    &quot;name&quot;: &quot;青铜会员&quot;,
                    &quot;id&quot;: 422
                },
                &quot;membershipCode&quot;: null,
                &quot;mobile&quot;: null,
                &quot;name&quot;: &quot;test&quot;,
                &quot;point&quot;: 0,
                &quot;source&quot;: null,
                &quot;contentName&quot;: null,
                &quot;campaignId&quot;: null,
                &quot;country&quot;: null,
                &quot;province&quot;: null,
                &quot;city&quot;: null,
                &quot;county&quot;: null
            }
        }
    ]
}
</code></pre>

<h2 id="9">9. 修改会员手机号</h2>
<ul>
<li>
<p>HTTP请求方式: <code>PUT</code></p>
</li>
<li>
<p><code>/loyalty/v1/membershipService/updateMobile?access_token={access_token}</code></p>
</li>
<li>
<p>Request Payload</p>
</li>
</ul>
<pre><code class="json">{
    &quot;oldMobile&quot;: &quot;123&quot;,
    &quot;newMobile&quot;: &quot;456&quot;,
    &quot;membershipId&quot;:8
}
</code></pre>

<ul>
<li>Response</li>
</ul>
<pre><code class="json">{
    &quot;address&quot;: null,
    &quot;balance&quot;: null,
    &quot;birthday&quot;: &quot;1999-01-01&quot;,
    &quot;c_111&quot;: null,
    &quot;c_1111&quot;: null,
    &quot;c_12&quot;: null,
    &quot;c_123&quot;: null,
    &quot;c_123123&quot;: null,
    &quot;c_Member&quot;: null,
    &quot;c_qqq&quot;: null,
    &quot;c_qwa123&quot;: null,
    &quot;c_qwqqw&quot;: null,
    &quot;c_sd&quot;: null,
    &quot;c_sdsf&quot;: null,
    &quot;c_wewe&quot;: null,
    &quot;c_wewe1&quot;: null,
    &quot;c_驱蚊器&quot;: null,
    &quot;createChannel&quot;: null,
    &quot;createMethod&quot;: &quot;外部系统导入&quot;,
    &quot;customerId&quot;: 20526992,
    &quot;dateCreated&quot;: &quot;2017-11-13T08:43:05Z&quot;,
    &quot;dateJoin&quot;: &quot;2017-11-13T08:43:05Z&quot;,
    &quot;educationBackgro&quot;: null,
    &quot;email&quot;: null,
    &quot;familyName&quot;: null,
    &quot;gender&quot;: 1,
    &quot;givenName&quot;: null,
    &quot;id&quot;: 85,
    &quot;idCard&quot;: null,
    &quot;img&quot;: null,
    &quot;income&quot;: null,
    &quot;industry&quot;: null,
    &quot;lastUpdated&quot;: &quot;2017-11-13T08:46:24Z&quot;,
    &quot;level&quot;: {
        &quot;priority&quot;: 0,
        &quot;name&quot;: &quot;青铜会员&quot;,
        &quot;id&quot;: 422
    }, 
    &quot;membershipCode&quot;: null,
    &quot;mobile&quot;: &quot;456&quot;,
    &quot;name&quot;: &quot;test&quot;,
    &quot;point&quot;: 0,
    &quot;contentName&quot;: null,
    &quot;campaignId&quot;: null,
    &quot;country&quot;: null,
    &quot;province&quot;: null,
    &quot;city&quot;: null,
    &quot;county&quot;: null
}
</code></pre>

<h2 id="10">10. 查看会员等级设置</h2>
<ul>
<li>
<p>HTTP请求方式: <code>GET</code></p>
</li>
<li>
<p><code>/loyalty/v1/settings/level/rules?access_token={access_token}</code></p>
</li>
<li>
<p>Response</p>
</li>
</ul>
<pre><code class="json">{
        &quot;rows&quot;: [
            {
                &quot;desp&quot;: null,
                &quot;id&quot;: 61,
                &quot;isForever&quot;: true,
                &quot;name&quot;: &quot;1&quot;,
                &quot;operator&quot;: &quot;or&quot;,
                &quot;priority&quot;: 0,
                &quot;rules&quot;: {
                    &quot;consumption&quot;: {
                        &quot;enabled&quot;: false,
                        &quot;month&quot;: 12,
                        &quot;number&quot;: 5000
                    },
                    &quot;consumptionTotal&quot;: {
                        &quot;enabled&quot;: false,
                        &quot;month&quot;: 12,
                        &quot;number&quot;: 5000
                    },
                    &quot;desp&quot;: &quot;默认最低等级&quot;,
                    &quot;frequency&quot;: {
                        &quot;enabled&quot;: false,
                        &quot;month&quot;: 12,
                        &quot;number&quot;: 5000
                    },
                    &quot;frequencyTotal&quot;: {
                        &quot;enabled&quot;: false,
                        &quot;month&quot;: 12,
                        &quot;number&quot;: 5000
                    },
                    &quot;points&quot;: {
                        &quot;enabled&quot;: false,
                        &quot;month&quot;: 12,
                        &quot;number&quot;: 5000
                    },
                    &quot;pointsTotal&quot;: {
                        &quot;enabled&quot;: false,
                        &quot;month&quot;: 12,
                        &quot;number&quot;: 5000
                    }
                },
                &quot;status&quot;: 0
            },
            {
                &quot;desp&quot;: null,
                &quot;id&quot;: 62,
                &quot;isForever&quot;: false,
                &quot;name&quot;: &quot;2&quot;,
                &quot;operator&quot;: &quot;or&quot;,
                &quot;priority&quot;: 1,
                &quot;rules&quot;: {},
                &quot;status&quot;: 0
            },
            {
                &quot;desp&quot;: null,
                &quot;id&quot;: 63,
                &quot;isForever&quot;: true,
                &quot;name&quot;: &quot;3&quot;,
                &quot;operator&quot;: &quot;or&quot;,
                &quot;priority&quot;: 2,
                &quot;rules&quot;: {},
                &quot;status&quot;: 0
            },
            {
                &quot;desp&quot;: null,
                &quot;id&quot;: 64,
                &quot;isForever&quot;: false,
                &quot;name&quot;: &quot;5&quot;,
                &quot;operator&quot;: &quot;or&quot;,
                &quot;priority&quot;: 3,
                &quot;rules&quot;: {},
                &quot;status&quot;: 0
            }
        ]
}
</code></pre>

<h2 id="11-api">11. 订单Api</h2>
<h3 id="111">11.1. 创建订单</h3>
<ul>
<li>HTTP请求方式: <code>POST</code></li>
<li><code>/loyalty/v1/deal?access_token={token}</code></li>
<li>Payload</li>
</ul>
<pre><code class="json">{
  &quot;membershipId&quot;: 1,
  &quot;orderNo&quot;: &quot;123456&quot;,
  &quot;dealLine&quot;: [
    {
      &quot;lineId&quot;: &quot;11111&quot;
    },
    {
    &quot;lineId&quot;: &quot;22222&quot;
    }
  ]
}

</code></pre>

<p>订单头</p>
<table>
<thead>
<tr>
<th>英文名称</th>
<th>字段名称</th>
<th>字段类型</th>
<th>必须字段</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>salesChannel</td>
<td>销售渠道</td>
<td>String</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>store</td>
<td>店铺</td>
<td>String</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>orderNo</td>
<td>订单号</td>
<td>String</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>订单类型</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>dateOrder</td>
<td>订单时间</td>
<td>DateTime</td>
<td>是</td>
<td>UTC时间</td>
</tr>
<tr>
<td>membershipId</td>
<td>会员ID</td>
<td>Number</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>amountDiscount</td>
<td>订单折扣</td>
<td>Number</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>couponCode</td>
<td>优惠券Code</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>groupId</td>
<td>团购ID</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>amountTotal</td>
<td>订单总额</td>
<td>Number</td>
<td></td>
<td></td>
</tr>
<tr>
<td>amountPaid</td>
<td>实际支付金额</td>
<td>Number</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>paymentTerm</td>
<td>支付方式</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>paymentNo</td>
<td>支付号</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>shippingMethod</td>
<td>运送方式</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>contactName</td>
<td>收货人姓名</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>contactTel</td>
<td>收货人手机</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>shippingProvince</td>
<td>收货人省份</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>shippingCity</td>
<td>收货人城市</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>shippingCounty</td>
<td>收货人区县</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>shippingStreet</td>
<td>收货人街道</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>shippingAddress</td>
<td>收货人具体地址</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>dealLines</td>
<td>订单行</td>
<td>JsonArray</td>
<td>是</td>
<td>结构见订单行</td>
</tr>
</tbody>
</table>
<p>订单行</p>
<table>
<thead>
<tr>
<th>英文名称</th>
<th>字段名称</th>
<th>字段类型</th>
<th>必须字段</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>lineId</td>
<td>订单行id</td>
<td>String</td>
<td>是</td>
<td>可使用skuid，在一个订单中保证唯一</td>
</tr>
<tr>
<td>productName</td>
<td>产品名称</td>
<td>String</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>productId</td>
<td>产品ID</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>skuId</td>
<td>SKU ID</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>category</td>
<td>品类</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>qty</td>
<td>数量</td>
<td>Number</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>priceUnit</td>
<td>单价</td>
<td>Number</td>
<td></td>
<td></td>
</tr>
<tr>
<td>priceSubTotal</td>
<td>总价</td>
<td>Number</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>Response</li>
</ul>
<p>成功</p>
<pre><code class="json">{
  &quot;membershipId&quot;: 1,
  &quot;orderNo&quot;: &quot;123456&quot;,
  &quot;id&quot;: &quot;1&quot;,
  &quot;dealLine&quot;: [
    {
      &quot;lineId&quot;: &quot;11111&quot;
    },
    {
      &quot;lineId&quot;: &quot;22222&quot;
    }
  ],
  &quot;state&quot;: &quot;已付款&quot;
}
</code></pre>

<p>失败</p>
<pre><code class="json">{
  &quot;error&quot;: {
  &quot;code&quot;:&quot;409000&quot;,
  &quot;message&quot;: &quot;error info&quot;
  }
}
</code></pre>

<h3 id="112">11.2. 取消订单</h3>
<ul>
<li>HTTP请求方式: <code>POST</code></li>
<li><code>/loyalty/v1/dealService/cancel?access_token={token}</code></li>
<li>Payload</li>
</ul>
<pre><code class="json">{
  &quot;membershipId&quot;: 1,
  &quot;orderNo&quot;: &quot;123456&quot;
}
</code></pre>

<ul>
<li>Response</li>
</ul>
<pre><code class="json">{
  &quot;membershipId&quot;: 1,
  &quot;orderNo&quot;: &quot;123456&quot;,
  &quot;id&quot;: &quot;1&quot;,
  &quot;dealLine&quot;: [
    {
      &quot;lineId&quot;: &quot;11111&quot;
    },
    {
      &quot;lineId&quot;: &quot;22222&quot;
    }
  ],
  &quot;state&quot;: &quot;已取消&quot;
}
</code></pre>

<h3 id="113">11.3. 退单</h3>
<ul>
<li>HTTP请求方式: <code>POST</code></li>
<li><code>/loyalty/v1/dealService/refund?access_token={token}</code></li>
<li>Payload</li>
</ul>
<pre><code class="json">{
  &quot;refundLines&quot;: [
    {
      &quot;lineId&quot;: &quot;11111&quot;
    }
  ],
  &quot;refundTotal&quot;: 1111,
  &quot;orderNo&quot;: &quot;123456&quot;,
  &quot;membershipId&quot;: 1
}
</code></pre>

<p>退单头</p>
<table>
<thead>
<tr>
<th>英文名称</th>
<th>字段名称</th>
<th>字段类型</th>
<th>必须字段</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>membershipId</td>
<td>会员ID</td>
<td>Number</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>orderNo</td>
<td>订单号</td>
<td>String</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>dateRefund</td>
<td>退单时间</td>
<td>DateTime</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>refundTotal</td>
<td>退单金额</td>
<td>Number</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>reason</td>
<td>退单原因</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>refundLines</td>
<td>退单行</td>
<td>JsonArray</td>
<td>是</td>
<td>结构见退单行</td>
</tr>
</tbody>
</table>
<p>退单行</p>
<table>
<thead>
<tr>
<th>英文名称</th>
<th>字段名称</th>
<th>字段类型</th>
<th>必须字段</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>lineId</td>
<td>订单行id</td>
<td>String</td>
<td>是</td>
<td>可使用skuid，在一个订单中保证唯一</td>
</tr>
</tbody>
</table>
<ul>
<li>Response</li>
</ul>
<pre><code class="json">{
  &quot;membershipId&quot;: 1,
  &quot;orderNo&quot;: &quot;123456&quot;,
  &quot;refundTotal&quot;: &quot;1&quot;,
  &quot;refundLines&quot;: [
    {
      &quot;lineId&quot;: &quot;11111&quot;
    }
  ]
}
</code></pre>

<h2 id="12">12. 会员注册推送设备信息</h2>
<p>请求方式：<code>POST</code></p>
<p>请求路径：<code>https://api.convertlab.com/loyalty/v1/appPush/register?access_token={access_token}</code></p>
<p>参数说明：</p>
<ul>
<li>access_token ：访问该 API 的令牌</li>
</ul>
<p>POST 数据说明：</p>
<pre><code class="json">{
    &quot;provider&quot;: &quot;&lt;必传&gt; 推送服务提供商，'jpush' 或 'getui'&quot;,
    &quot;appKey&quot;: &quot;&lt;必传&gt; 在推送服务提供商平台创建应用时得到的 AppKey&quot;,
    &quot;pushId&quot;: &quot;&lt;必传&gt; 推送服务提供商分配给设备的 PushID（极光称作 Registration ID，个推称作 ClientID，本文档统一称作 PushID）&quot;,
    &quot;os&quot;: &quot;&lt;必传&gt; 移动端平台类型，'android' 或 'ios'&quot;,
    &quot;membershipId&quot;: &quot;&lt;非必传&gt; 会员 ID。&quot;,
    &quot;mobile&quot;: &quot;&lt;非必传&gt; 会员手机号。&quot;
}
</code></pre>

<p>注：<em>membershipId</em> 参数和 <em>mobile</em> 参数用于将推送设备信息与会员建立关联，建立关联过程中，优先根据 <em>membershipId</em> 查找会员，如果没有找到会员，再根据 <em>mobile</em> 查找会员，如果找到会员，则将推送设备信息与该会员建立关联；否则，推送设备信息会被注册为匿名的信息。</p>
<p>返回结果说明：</p>
<ul>
<li>注册成功</li>
</ul>
<pre><code class="json">{
    &quot;appKey&quot;: &quot;&lt;AppKey&gt;&quot;,
    &quot;membershipId&quot;: &quot;&lt;会员 ID&gt;&quot;,
    &quot;os&quot;: &quot;&lt;os&gt;&quot;,
    &quot;provider&quot;: &quot;&lt;provider&gt;&quot;,
    &quot;pushId&quot;: &quot;&lt;PushID&gt;&quot;
}
</code></pre>

<p>注：如果返回结果中的 <em>membershiprId</em> 为 <code>null</code>，则表明推送设备信息被注册为匿名的信息。</p>
<ul>
<li>必传字段缺失</li>
</ul>
<pre><code class="json">{
    &quot;error&quot;: {
        &quot;code&quot;: &quot;400005&quot;,
        &quot;message&quot;: &quot;Missing field provider!&quot;
    }
}
</code></pre>

<ul>
<li>必传字段无效</li>
</ul>
<pre><code class="json">{
    &quot;error&quot;: {
        &quot;code&quot;: &quot;400001&quot;,
        &quot;message&quot;: &quot;Invalid os(winphone)!&quot;
    }
}
</code></pre>

<h2 id="13-api">13. 优惠券Api</h2>
<h3 id="_3">模型</h3>
<p>优惠券包括优惠券（coupon）和优惠券认领（membershipCoupon） 两个模型。操作员在会员系统的前端设置了一个优惠券后，会生成一个coupon实体；在会员领取/系统发放之后，系统会生成某会员专属的一个membershipCoupon实体。</p>
<p>每一个coupon都有唯一标识couponId，每一个membershipCoupon都有唯一标识couponCode。具体的模型如下。</p>
<p>coupon</p>
<table>
<thead>
<tr>
<th>英文名称</th>
<th>字段名称</th>
<th>字段类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>couponId</td>
<td>优惠券id</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>couponName</td>
<td>优惠券名称</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>couponLabel</td>
<td>优惠券标题</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>couponSubLabel</td>
<td>优惠券副标题</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>couponType</td>
<td>优惠券类型</td>
<td>Number</td>
<td>1为代金券，2为折扣券，3为商品券</td>
</tr>
<tr>
<td>channels</td>
<td>优惠券渠道</td>
<td>JsonArray</td>
<td>目前界面最多可设置线上和线下两个渠道</td>
</tr>
<tr>
<td>drawLimit</td>
<td>每人限令张数</td>
<td>Number</td>
<td></td>
</tr>
<tr>
<td>total</td>
<td>总张数</td>
<td>Number</td>
<td></td>
</tr>
<tr>
<td>store</td>
<td>库存</td>
<td>Number</td>
<td></td>
</tr>
<tr>
<td>note</td>
<td>使用须知</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>validType</td>
<td>有效类型</td>
<td>Number</td>
<td>1为绝对日期范围，2为相对领取时间</td>
</tr>
<tr>
<td>validDate</td>
<td>有效日期</td>
<td>JsonObject</td>
<td>根据validType区分</td>
</tr>
<tr>
<td>rule</td>
<td>使用规则</td>
<td>JsonObject</td>
<td></td>
</tr>
</tbody>
</table>
<p>coupon.channels</p>
<table>
<thead>
<tr>
<th>英文名称</th>
<th>字段名称</th>
<th>字段类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>couponId</td>
<td>优惠券渠道码</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>couponChannel</td>
<td>优惠券渠道</td>
<td>String</td>
<td>目前有两个渠道，线上online，线下offline</td>
</tr>
<tr>
<td>url</td>
<td>渠道对应的url</td>
<td>String</td>
<td></td>
</tr>
</tbody>
</table>
<p>coupon.validDate</p>
<table>
<thead>
<tr>
<th>英文名称</th>
<th>字段名称</th>
<th>字段类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>startDays</td>
<td>领取后有效起始天数</td>
<td>Number</td>
<td>相对有效日期使用</td>
</tr>
<tr>
<td>validDays</td>
<td>有效后终止天数</td>
<td>Number</td>
<td>相对有效日期使用</td>
</tr>
<tr>
<td>startDate</td>
<td>起始有效期</td>
<td>Date</td>
<td>绝对有效日期使用</td>
</tr>
<tr>
<td>endDate</td>
<td>终止有效期</td>
<td>Date</td>
<td>绝对有效日期使用</td>
</tr>
</tbody>
</table>
<p>coupon.rule</p>
<table>
<thead>
<tr>
<th>英文名称</th>
<th>字段名称</th>
<th>字段类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>amountLimit</td>
<td>最低消费</td>
<td>Number</td>
<td></td>
</tr>
<tr>
<td>discount</td>
<td>折扣额度</td>
<td>Number</td>
<td>折扣券使用</td>
</tr>
<tr>
<td>freeFee</td>
<td>减免金额</td>
<td>Number</td>
<td>代金券使用</td>
</tr>
<tr>
<td>goodsLimit</td>
<td>指定商品</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>...</td>
<td>自定义规则</td>
<td>...</td>
<td></td>
</tr>
</tbody>
</table>
<p>membershipCoupon</p>
<table>
<thead>
<tr>
<th>英文名称</th>
<th>字段名称</th>
<th>字段类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>membershipId</td>
<td>会员id</td>
<td>Number</td>
<td></td>
</tr>
<tr>
<td>couponId</td>
<td>优惠券id</td>
<td>String</td>
<td>折扣券使用</td>
</tr>
<tr>
<td>dateDraw</td>
<td>领取日期</td>
<td>DateTime</td>
<td>代金券使用</td>
</tr>
<tr>
<td>dateRedeem</td>
<td>核销日期</td>
<td>DateTime</td>
<td></td>
</tr>
<tr>
<td>startDate</td>
<td>起始有效期</td>
<td>Date</td>
<td></td>
</tr>
<tr>
<td>endDate</td>
<td>终止有效期</td>
<td>Date</td>
<td></td>
</tr>
<tr>
<td>status</td>
<td>状态</td>
<td>Number</td>
<td>折扣券使用</td>
</tr>
<tr>
<td>couponCode</td>
<td>券码</td>
<td>String</td>
<td>代金券使用</td>
</tr>
<tr>
<td>uuid</td>
<td>券码加密</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>barcodeUrl</td>
<td>条形码地址</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>qrcodeUrl</td>
<td>二维码地址</td>
<td>String</td>
<td></td>
</tr>
</tbody>
</table>
<p>membershipCoupon.status</p>
<table>
<thead>
<tr>
<th>返回值</th>
<th>normal</th>
<th>used</th>
</tr>
</thead>
<tbody>
<tr>
<td>含义</td>
<td>可使用</td>
<td>已使用</td>
</tr>
</tbody>
</table>
<h3 id="131coupon">13.1.获取所有coupon</h3>
<p><code>GET /loyalty/v1/coupon</code></p>
<ul>
<li>Request</li>
</ul>
<p>access_token  根据appid请求的token 
needTotal     是否需要总页数
rows          每页行数
page          所选页数
sidx          排序字段
sord          升序asc或降序desc</p>
<ul>
<li>Response</li>
</ul>
<pre><code class="json">{
  &quot;rows&quot;: [
    {
      &quot;channels&quot;: [
        {
          &quot;couponId&quot;: &quot;test&quot;,
          &quot;couponChannel&quot;: &quot;offline&quot;,
          &quot;url&quot;: null
        }
      ],
      &quot;couponId&quot;: &quot;STxgWromTbt727eBcPOo&quot;,
      &quot;couponLabel&quot;: &quot;test&quot;,
      &quot;couponName&quot;: &quot;test&quot;,
      &quot;couponSubLabel&quot;: &quot;test&quot;,
      &quot;couponType&quot;: 1,
      &quot;drawLimit&quot;: 100,
      &quot;note&quot;: &quot;test&quot;,
      &quot;rule&quot;: {
        &quot;amountLimit&quot;: null,
        &quot;discount&quot;: null,
        &quot;freeFee&quot;: null,
        &quot;goodsLimit&quot;: &quot;null&quot;
      },
      &quot;total&quot;: 100000,
      &quot;validDate&quot;: {
        &quot;startDays&quot;: 5,
        &quot;validDays&quot;: 5
      },
      &quot;validType&quot;: 2
      }
      ],
  &quot;total&quot;: 12, //总页数
  &quot;records&quot;: 10 //总条数
}
</code></pre>

<p>只有在使用needTotal后会有total和records值。</p>
<h3 id="132couponidcoupon">13.2.根据couponId获取coupon</h3>
<p><code>GET /loyalty/v1/coupon/$couponId</code></p>
<ul>
<li>Request</li>
</ul>
<p>access_token  根据appid请求的token</p>
<ul>
<li>Response</li>
</ul>
<p>成功</p>
<pre><code class="json">{
  &quot;channels&quot;: [
    {
      &quot;couponId&quot;: &quot;test&quot;,
      &quot;couponChannel&quot;: &quot;offline&quot;,
      &quot;url&quot;: null
    }
  ],
  &quot;couponId&quot;: &quot;STxgWromTbt727eBcPOo&quot;,
  &quot;couponLabel&quot;: &quot;test&quot;,
  &quot;couponName&quot;: &quot;test&quot;,
  &quot;couponSubLabel&quot;: &quot;test&quot;,
  &quot;couponType&quot;: 1,
  &quot;drawLimit&quot;: 100,
  &quot;note&quot;: &quot;test&quot;,
  &quot;rule&quot;: {
    &quot;amountLimit&quot;: null,
    &quot;discount&quot;: null,
    &quot;freeFee&quot;: null,
    &quot;goodsLimit&quot;: &quot;null&quot;
  },
  &quot;total&quot;: 100000,
  &quot;validDate&quot;: {
    &quot;startDays&quot;: 5,
    &quot;validDays&quot;: 5
  },
  &quot;validType&quot;: 2
}
</code></pre>

<p>失败</p>
<pre><code class="json">{
  &quot;error&quot;: {
    &quot;code&quot;:&quot;409000&quot;,
    &quot;message&quot;: &quot;error info&quot;
  }
}
</code></pre>

<h3 id="133couponchannelcoupon">13.3.根据couponChannel获取coupon</h3>
<p><code>GET /loyalty/v1/couponService/getCouponByChannel</code></p>
<ul>
<li>Request</li>
</ul>
<p>access_token  根据appid请求的token
channel       online或者offline
couponId      对应渠道的couponId</p>
<ul>
<li>Response</li>
</ul>
<p>成功</p>
<pre><code class="json">{
  &quot;rows&quot;: [
    {
      &quot;channels&quot;: [
        {
          &quot;couponId&quot;: &quot;test&quot;,
          &quot;couponChannel&quot;: &quot;offline&quot;,
          &quot;url&quot;: null
        }
      ],
      &quot;couponId&quot;: &quot;STxgWromTbt727eBcPOo&quot;,
      &quot;couponLabel&quot;: &quot;test&quot;,
      &quot;couponName&quot;: &quot;test&quot;,
      &quot;couponSubLabel&quot;: &quot;test&quot;,
      &quot;couponType&quot;: 1,
      &quot;drawLimit&quot;: 100,
      &quot;note&quot;: &quot;test&quot;,
      &quot;rule&quot;: {
        &quot;amountLimit&quot;: null,
        &quot;discount&quot;: null,
        &quot;freeFee&quot;: null,
        &quot;goodsLimit&quot;: &quot;null&quot;
      },
      &quot;total&quot;: 100000,
      &quot;validDate&quot;: {
        &quot;startDays&quot;: 5,
        &quot;validDays&quot;: 5
      },
      &quot;validType&quot;: 2
    }
  ]
}
</code></pre>

<p>失败</p>
<pre><code class="json">{
  &quot;error&quot;: {
    &quot;code&quot;:&quot;409000&quot;,
    &quot;message&quot;: &quot;error info&quot;
  }
}
</code></pre>

<h3 id="134">13.4.领券</h3>
<p><code>POST /loyalty/v1/membership/$membershipId/coupon/draw</code></p>
<ul>
<li>Request</li>
</ul>
<p>access_token  根据appid请求的token</p>
<ul>
<li>Payload</li>
</ul>
<pre><code class="json">{
&quot;couponId&quot;: &quot;11111&quot;
}
</code></pre>

<ul>
<li>Response</li>
</ul>
<p>成功</p>
<pre><code class="json">{
  &quot;dateDraw&quot;: &quot;2017-12-05T05:54:10Z&quot;,
  &quot;endDate&quot;: &quot;2017-12-15&quot;,
  &quot;couponId&quot;: &quot;STxgWromTbt727eBcPOo&quot;,
  &quot;qrcodeUrl&quot;: &quot;http://127.0.0.1:8004/loyalty/qrimg/cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0&quot;,
  &quot;membershipId&quot;: 1,
  &quot;barcodeUrl&quot;: &quot;http://127.0.0.1:8004/loyalty/barimg/cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0&quot;,
  &quot;dateRedeem&quot;: null,
  &quot;uuid&quot;: &quot;cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0\r\n&quot;,
  &quot;startDate&quot;: &quot;2017-12-10&quot;,
  &quot;couponCode&quot;: &quot;34636772868722688&quot;,
  &quot;status&quot;: &quot;notStarted&quot;,
  &quot;couponType&quot;: 1,
  &quot;couponName&quot;: &quot;test&quot;,
  &quot;couponLabel&quot;: &quot;test&quot;,
  &quot;couponSubLabel&quot;: &quot;test&quot;,
  &quot;note&quot;: &quot;test&quot;,
  &quot;channels&quot;: [
    {
      &quot;couponId&quot;: &quot;test&quot;,
      &quot;couponChannel&quot;: &quot;offline&quot;,
      &quot;url&quot;: null
    }
  ],
  &quot;rule&quot;: {
    &quot;goodsLimit&quot;: &quot;null&quot;,
    &quot;freeFee&quot;: null,
    &quot;discount&quot;: null,
    &quot;amountLimit&quot;: null
  }
}
</code></pre>

<p>从couponType开始，之后的字段是这张券所属coupon的信息。</p>
<p>失败</p>
<pre><code class="json">{
  &quot;error&quot;: {
    &quot;code&quot;:&quot;409000&quot;,
    &quot;message&quot;: &quot;error info&quot;
  }
}
</code></pre>

<h3 id="135couponcodemembershipcoupon">13.5.根据couponCode获取membershipCoupon</h3>
<p><code>GET /loyalty/v1/membershipCoupon/$couponCode</code></p>
<ul>
<li>Request</li>
</ul>
<p>access_token  根据appid请求的token</p>
<ul>
<li>Response</li>
</ul>
<p>成功</p>
<pre><code class="json">{
  &quot;dateDraw&quot;: &quot;2017-12-05T05:54:10Z&quot;,
  &quot;endDate&quot;: &quot;2017-12-15&quot;,
  &quot;couponId&quot;: &quot;STxgWromTbt727eBcPOo&quot;,
  &quot;qrcodeUrl&quot;: &quot;http://127.0.0.1:8004/loyalty/qrimg/cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0&quot;,
  &quot;membershipId&quot;: 1,
  &quot;barcodeUrl&quot;: &quot;http://127.0.0.1:8004/loyalty/barimg/cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0&quot;,
  &quot;dateRedeem&quot;: null,
  &quot;uuid&quot;: &quot;cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0\r\n&quot;,
  &quot;startDate&quot;: &quot;2017-12-10&quot;,
  &quot;couponCode&quot;: &quot;34636772868722688&quot;,
  &quot;status&quot;: &quot;notStarted&quot;,
  &quot;couponType&quot;: 1,
  &quot;couponName&quot;: &quot;test&quot;,
  &quot;couponLabel&quot;: &quot;test&quot;,
  &quot;couponSubLabel&quot;: &quot;test&quot;,
  &quot;note&quot;: &quot;test&quot;,
  &quot;channels&quot;: [
    {
      &quot;couponId&quot;: &quot;test&quot;,
      &quot;couponChannel&quot;: &quot;offline&quot;,
      &quot;url&quot;: null
    }
  ],
  &quot;rule&quot;: {
    &quot;goodsLimit&quot;: &quot;null&quot;,
    &quot;freeFee&quot;: null,
    &quot;discount&quot;: null,
    &quot;amountLimit&quot;: null
  }
}
</code></pre>

<h3 id="136membershipidmembershipcoupon">13.6.根据membershipId获取membershipCoupon列表</h3>
<p><code>GET /loyalty/v1/membership/$membershipId/coupon</code></p>
<ul>
<li>Request</li>
</ul>
<p>access_token  根据appid请求的token
status 筛选membershipCoupon状态，normal为可使用，used为已使用</p>
<ul>
<li>Response</li>
</ul>
<p>成功</p>
<pre><code class="json">{
  &quot;rows&quot;: [
    {
      &quot;dateDraw&quot;: &quot;2017-12-05T05:54:10Z&quot;,
      &quot;endDate&quot;: &quot;2017-12-15&quot;,
      &quot;couponId&quot;: &quot;STxgWromTbt727eBcPOo&quot;,
      &quot;qrcodeUrl&quot;: &quot;http://127.0.0.1:8004/loyalty/qrimg/cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0&quot;,
      &quot;membershipId&quot;: 1,
      &quot;barcodeUrl&quot;: &quot;http://127.0.0.1:8004/loyalty/barimg/cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0&quot;,
      &quot;dateRedeem&quot;: null,
      &quot;uuid&quot;: &quot;cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0\r\n&quot;,
      &quot;startDate&quot;: &quot;2017-12-10&quot;,
      &quot;couponCode&quot;: &quot;34636772868722688&quot;,
      &quot;status&quot;: &quot;notStarted&quot;,
      &quot;couponType&quot;: 1,
      &quot;couponName&quot;: &quot;test&quot;,
      &quot;couponLabel&quot;: &quot;test&quot;,
      &quot;couponSubLabel&quot;: &quot;test&quot;,
      &quot;note&quot;: &quot;test&quot;,
      &quot;channels&quot;: [
        {
          &quot;couponId&quot;: &quot;test&quot;,
          &quot;couponChannel&quot;: &quot;offline&quot;,
          &quot;url&quot;: null
        }
      ],
      &quot;rule&quot;: {
        &quot;goodsLimit&quot;: &quot;null&quot;,
        &quot;freeFee&quot;: null,
        &quot;discount&quot;: null,
        &quot;amountLimit&quot;: null
      }
    }
  ],
  &quot;total&quot;: 12,
  &quot;records&quot;: 10
}
</code></pre>

<h3 id="137">13.7.核销</h3>
<p><code>POST /loyalty/v1/membershipCoupon/$couponCode/redeem</code></p>
<ul>
<li>Request</li>
</ul>
<p>access_token  根据appid请求的token</p>
<ul>
<li>Payload</li>
</ul>
<pre><code class="json">{
&quot;membershipId&quot;: 1
}
</code></pre>

<ul>
<li>Response</li>
</ul>
<p>成功</p>
<pre><code class="json">{
  &quot;dateDraw&quot;: &quot;2017-12-05T05:54:10Z&quot;,
  &quot;endDate&quot;: &quot;2017-12-15&quot;,
  &quot;couponId&quot;: &quot;STxgWromTbt727eBcPOo&quot;,
  &quot;qrcodeUrl&quot;: &quot;http://127.0.0.1:8004/loyalty/qrimg/cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0&quot;,
  &quot;membershipId&quot;: 1,
  &quot;barcodeUrl&quot;: &quot;http://127.0.0.1:8004/loyalty/barimg/cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0&quot;,
  &quot;dateRedeem&quot;: null,
  &quot;uuid&quot;: &quot;cnik8caw3EqPVCLAFP4IsmVeXwqb-EtxJSw3gugIq-0\r\n&quot;,
  &quot;startDate&quot;: &quot;2017-12-10&quot;,
  &quot;couponCode&quot;: &quot;34636772868722688&quot;,
  &quot;status&quot;: &quot;used&quot;,
  &quot;couponType&quot;: 1,
  &quot;couponName&quot;: &quot;test&quot;,
  &quot;couponLabel&quot;: &quot;test&quot;,
  &quot;couponSubLabel&quot;: &quot;test&quot;,
  &quot;note&quot;: &quot;test&quot;,
  &quot;channels&quot;: [
    {
      &quot;couponId&quot;: &quot;test&quot;,
      &quot;couponChannel&quot;: &quot;offline&quot;,
      &quot;url&quot;: null
    }
  ],
  &quot;rule&quot;: {
    &quot;goodsLimit&quot;: &quot;null&quot;,
    &quot;freeFee&quot;: null,
    &quot;discount&quot;: null,
    &quot;amountLimit&quot;: null
  }
}
</code></pre>
            <div class="ds-thread" data-thread-key="Api接口" data-title="Api接口" data-url=""></div>
        </div>
        
    </div>
    
    </script>
</body>

</html>