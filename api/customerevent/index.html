<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="canonical" href="http://api-docs.convertlab.com/api/customerevent/"> 
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <title>客户事件 - Convertlab 文档中心</title>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../test/css/print.css" rel="stylesheet">

    
</head>
<body>
    <div class="navbar navbar-default" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://www.convertlab.com/">Convertlab 文档中心</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                
                  <li class="pull-left active">
                    
                    <a href="../..">OpenAPI V1</a>
                    
                  </li>
                
                  <li class="pull-left">
                    
                    <a href="../../track/jscollection/">前端埋点</a>
                    
                  </li>
                
                  <li class="pull-left">
                    
                    <a href="../../member/">会员(Beta)</a>
                    
                  </li>
                
                  <!--<li class="pull-left">
                    
                    <a href="/test/">TRY IT</a>
                    
                  </li>-->
                </ul>
            
        </div>
    </div>
</div>
    <div class="container main">
       <!--   <div class="toolbar clearfix">
  <ol class="breadcrumb pull-left">
    <li><a href="">文档</a></li>
    <li>客户事件</li>
  </ol>

  
    
      <a href="https://github.com/xsio/open_api_docs" class="github-edit pull-right"><i class="fa fa-github"></i> Edit on GitHub</a>
    
  

</div> -->
        <div class="col-md-3"><div class="bs-sidebar hidden-print" data-spy="affix" data-offset-top="80" role="complementary">
    <ul class="nav bs-sidenav">
     
      
        
          

              <li class="">
                <a class="itm-l1" href="../..">创建集成应用</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="../accesstoken/">获取ACCESS_TOKEN</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="../customer/">客户信息</a>
                
              </li>

          

              <li class="active">
                <a class="itm-l1" href="./">客户事件</a>
                
                  <ul class="nav">
                  
                    <li class="active "><a href="#_1">客户事件模型</a></li>
                    
                  
                    <li class=""><a href="#api">创建客户事件的API</a></li>
                    
                  
                    <li class=""><a href="#api_1">获取单个事件的API</a></li>
                    
                  
                    <li class=""><a href="#api_2">查询事件的API</a></li>
                    
                  
                  </ul>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="../tag/">客户标签</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="../list/">客户群组</a>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="../deal/">客户交易</a>
                
              </li>

          
        
      

    
      
        
      

    
      
        
      

    
    </ul>
</div></div>
        <div class="col-md-9 content-body" role="main">
             

<h1>客户事件</h1>

<h2 id="_1">客户事件模型</h2>
<p>在DM Hub中，客户的行为都是以客户事件（CustomerEvent）的形式记录的。客户事件会记录客户发生相关行为的所有信息，例如具体行为，行为发生时间，行为涉及的内容，等。DM Hub会根据客户的事件记录进行相关的客户行为分析，漏斗分析，触发自动流程等。通常来讲，客户事件是不可更改不可删除的，因为一般的，客户行为一旦发生便不可逆转。更改客户事件可能会造成DM Hub一些行为的不准确。</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>属性意义</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>客户事件ID</td>
<td>Long</td>
<td>只读字段</td>
</tr>
<tr>
<td>customerId</td>
<td>客户id</td>
<td>Long</td>
<td>发生行为的客户。</td>
</tr>
<tr>
<td>event</td>
<td>事件类型</td>
<td>String</td>
<td>事件类型，最长32个英文字符。</td>
</tr>
<tr>
<td>targetId</td>
<td>行为所关联的目标id</td>
<td>String</td>
<td>比如如果事件为关注公众号，targetId为公众号在DM Hub系统中的id。最长255个字符。</td>
</tr>
<tr>
<td>targetName</td>
<td>行为所关联的目标名称</td>
<td>String</td>
<td>比如如果事件为关注公众号，targetName为公众号的名字。最长255个字符。</td>
</tr>
<tr>
<td>date</td>
<td>行为所发生的时间</td>
<td>String</td>
<td>格式为:“2017-06-07T12:20:20Z”</td>
</tr>
<tr>
<td>source</td>
<td>来源</td>
<td>String</td>
<td>预先设定的来源，比如订单是从淘宝来的，则来源可以设置为淘宝。</td>
</tr>
<tr>
<td>score</td>
<td>客户活跃度</td>
<td>Integer</td>
<td>发送该事件会给客户增加多少活跃度。</td>
</tr>
<tr>
<td>tag</td>
<td>事件发生后为客户添加的内容标签</td>
<td>String</td>
<td>多个标签可以用逗号隔开。最长255个字符。</td>
</tr>
<tr>
<td>campaign</td>
<td>营销活动code</td>
<td>String</td>
<td>DM Hub创建的营销活动代码</td>
</tr>
<tr>
<td>campaignName</td>
<td>营销活动名称</td>
<td>String</td>
<td>DM Hub创建的营销活动的名称</td>
</tr>
<tr>
<td>lastUpdated</td>
<td>事件记录进入在DM Hub系统的时间</td>
<td>String</td>
<td>只读字段</td>
</tr>
</tbody>
</table>
<p>系统已经内置了以下事件，可以通过访问DM Hub的 <strong>设置 &gt; 客户事件</strong> 页面查看</p>
<p><img src="../../resources/customerevent1.png" width="600"/></p>
<p>该页面列出了所有内置事件的类型id，推进阶段和默认的活跃度评分。</p>
<p>除了系统内置事件，您还可以添加自定义事件。要添加自定义事件，请在客户设置页面点击 新建自定义事件 按钮：</p>
<p><img src="../../resources/customerevent2.png" width="600"/></p>
<p>在自定义事件创建对话框中，您可以设置事件的类型id，默认活跃度分数，和事件推进阶段。为了避免将来与内置事件类型发生冲突，自定义事件类型都强制以c_开头，比如上图中的事件类型id为c_apply_card。</p>
<p>对于自定义事件类型，除了系统内置的属性 (见 客户事件模型) 外，还能添加最多5个自定义属性。要添加自定义属性，请在自定义事件对话框内点击 添加自定义属性 按钮。</p>
<p>还是以申请信用卡事件c_apply_card为例，我们可以增加一个属性touter来记录地推人员的id。</p>
<p><img src="../../resources/customerevent3.png" width="600"/></p>
<h2 id="api">创建客户事件的API</h2>
<p>我们以上面定义的自定义事件c_apply_card为例介绍客户事件的创建。</p>
<p><strong>调用请求</strong></p>
<pre><code>HTTP请求方式: POST
https://api.convertlab.com/v1/customerevents?access_token={access_token}

POST请求示例：
{
  &quot;customerId&quot;: &quot;123456&quot;,
  &quot;event&quot;: &quot;c_apply_card&quot;,
  &quot;targetId&quot;: &quot;golden_card&quot;,
  &quot;targetName&quot;: &quot;金卡&quot;,
  &quot;date&quot;: &quot;2017-06-07T03:43:00Z&quot;,
  &quot;source&quot;: &quot;人民广场&quot;,
  &quot;touter&quot;: &quot;t00001&quot;
}
</code></pre>

<p><strong>参数说明</strong>
- {access_token}为访问接口的令牌
- 请求体内字段的意义请参见客户事件模型部分</p>
<p><strong>返回结果</strong></p>
<pre><code>{
  &quot;id&quot;: 1,
  &quot;customerId&quot;: 123456,
  &quot;event&quot;: &quot;c_apply_card&quot;,
  &quot;targetId&quot;: &quot;golden_card&quot;,
  &quot;targetName&quot;: &quot;金卡&quot;,
  &quot;date&quot;: &quot;2017-06-07T03:43:00Z&quot;,
  &quot;source&quot;: &quot;人民广场&quot;,
  &quot;score&quot;: 0,
  &quot;tag&quot;: null,
  &quot;campaign&quot;: null,
  &quot;campaignName&quot;: null,
  &quot;contentName&quot;: null,
  &quot;externalId&quot;: null,
  &quot;lastUpdated&quot;: &quot;2017-06-07T05:38:52Z&quot;,
  &quot;touter&quot;: &quot;t00001&quot;
}
</code></pre>

<h2 id="api_1">获取单个事件的API</h2>
<p><strong>调用请求</strong></p>
<pre><code>HTTP请求方式: GET
https://api.convertlab.com/v1/customerevents/{id}?access_token={access_token}
</code></pre>

<p><strong>参数说明</strong>
- {access_token}用从“获取身份权限”节拿到的access_token替换
- id 客户事件id</p>
<p><strong>返回结果</strong></p>
<pre><code>{
  &quot;id&quot;: 1,
  &quot;customerId&quot;: 123456,
  &quot;event&quot;: &quot;c_apply_card&quot;,
  &quot;targetId&quot;: &quot;golden_card&quot;,
  &quot;targetName&quot;: &quot;金卡&quot;,
  &quot;date&quot;: &quot;2017-06-07T03:43:00Z&quot;,
  &quot;source&quot;: &quot;人民广场&quot;,
  &quot;score&quot;: 0,
  &quot;tag&quot;: null,
  &quot;campaign&quot;: null,
  &quot;campaignName&quot;: null,
  &quot;contentName&quot;: null,
  &quot;externalId&quot;: null,
  &quot;lastUpdated&quot;: &quot;2017-06-07T05:38:52Z&quot;,
  &quot;touter&quot;: &quot;t00001&quot;
}
</code></pre>

<h2 id="api_2">查询事件的API</h2>
<p><strong>调用请求</strong></p>
<pre><code>HTTP请求方式: GET
https://api.convertlab.com/v1/customerevents?access_token={access_token}&amp;customerId={customerId}&amp;event={event}&amp;lastUpdatedFrom={lastUpdatedFrom}&amp;lastUpdatedTo={lastUpdatedTo}&amp;max={max}&amp;rows={rows}&amp;page={page}&amp;sidx={sidx}&amp;sord={sord}
</code></pre>

<p><strong>参数说明</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>是否必填</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>access_token</td>
<td>是</td>
<td>访问API的令牌</td>
</tr>
<tr>
<td>customerId</td>
<td>否</td>
<td>查询指定客户的事件列表</td>
</tr>
<tr>
<td>event</td>
<td>否</td>
<td>查询指定的事件类型。多个事件类型可用逗号分开</td>
</tr>
<tr>
<td>lastUpdatedFrom</td>
<td>否</td>
<td>事件更新的起始时间。时间格式为 “2017-06-07T12:13:14Z”, 为UTC时间</td>
</tr>
<tr>
<td>lastUpdatedTo</td>
<td>否</td>
<td>事件更新的结束时间。时间格式同上</td>
</tr>
<tr>
<td>max</td>
<td>否</td>
<td>最多返回多少条数据，默认为20，最大可到1000</td>
</tr>
<tr>
<td>rows</td>
<td>否</td>
<td>每页的记录数</td>
</tr>
<tr>
<td>page</td>
<td>否</td>
<td>起始页数，以1开始</td>
</tr>
<tr>
<td>sidx</td>
<td>否</td>
<td>排序的字段，比如如果按lastUpdated排序，sidx=lastUpdated</td>
</tr>
<tr>
<td>sord</td>
<td>否</td>
<td>asc表示升序，desc表示降序，默认为升序</td>
</tr>
</tbody>
</table>
<p><strong>返回结果</strong></p>
<pre><code>[
  {
    &quot;id&quot;: 1,
    &quot;customerId&quot;: 123456,
    &quot;event&quot;: &quot;c_apply_card&quot;,
    &quot;targetId&quot;: &quot;golden_card&quot;,
    &quot;targetName&quot;: &quot;金卡&quot;,
    &quot;date&quot;: &quot;2017-06-07T03:43:00Z&quot;,
    &quot;source&quot;: &quot;人民广场&quot;,
    &quot;score&quot;: 0,
    &quot;tag&quot;: null,
    &quot;campaign&quot;: null,
    &quot;campaignName&quot;: null,
    &quot;contentName&quot;: null,
    &quot;externalId&quot;: null,
    &quot;lastUpdated&quot;: &quot;2017-06-07T06:43:29Z&quot;,
    &quot;touter&quot;: &quot;t00003&quot;
  }
]
</code></pre>
            <div class="ds-thread" data-thread-key="客户事件" data-title="客户事件" data-url=""></div>
        </div>
        
    </div>
    
    </script>
</body>

</html>