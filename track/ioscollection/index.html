<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="canonical" href="http://api-docs.convertlab.com/track/ioscollection/"> 
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <title>通过IOS SDK进行数据采集 - Convertlab 文档中心</title>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../test/css/print.css" rel="stylesheet">

    
</head>
<body>
    <div class="navbar navbar-default" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="http://www.convertlab.com/">Convertlab 文档中心</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                
                  <li class="pull-left">
                    
                    <a href="../..">OpenAPI V1</a>
                    
                  </li>
                
                  <li class="pull-left active">
                    
                    <a href="../jscollection/">网页埋点</a>
                    
                  </li>
                
                  <li class="pull-left">
                    
                    <a href="/test/">TRY IT</a>
                    
                  </li>
                </ul>
            
        </div>
    </div>
</div>
    <div class="container main">
       <!--   <div class="toolbar clearfix">
  <ol class="breadcrumb pull-left">
    <li><a href="">文档</a></li>
    <li>通过IOS SDK进行数据采集</li>
  </ol>

  
    
      <a href="https://github.com/xsio/open_api_docs" class="github-edit pull-right"><i class="fa fa-github"></i> Edit on GitHub</a>
    
  

</div> -->
        <div class="col-md-3"><div class="bs-sidebar hidden-print" data-spy="affix" data-offset-top="80" role="complementary">
    <ul class="nav bs-sidenav">
     
      
        
      

    
      
        
          

              <li class="">
                <a class="itm-l1" href="../jscollection/">通过PC端的JS SDK进行数据采集</a>
                
              </li>

          

              <li class="active">
                <a class="itm-l1" href="./">通过IOS SDK进行数据采集</a>
                
                  <ul class="nav">
                  
                    <li class="active "><a href="#ios-sdk">iOS SDK 开发指南</a></li>
                    
                  
                    <li class=""><a href="#1">1. 使用说明</a></li>
                    
                  
                    <li class=""><a href="#2">2. 开发准备</a></li>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#21">2.1 创建应用</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#22">2.2 工程准备</a></li>
                      </ul>
                    
                  
                    <li class=""><a href="#3-sdk">3. 导入 SDK</a></li>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#31-sdk">3.1 添加 SDK 文件</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#32">3.2 添加系统库支持</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#33">3.3 检查静态库文件路径</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#34">3.4 引入头文件</a></li>
                      </ul>
                    
                  
                    <li class=""><a href="#4-sdk">4. 配置 SDK 相关参数</a></li>
                    
                  
                    <li class=""><a href="#5">5. 创建客户和客户身份</a></li>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#51-jpush">5.1 创建带有 JPush 身份的客户</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#52-getui">5.2 创建带有 GeTui 身份的客户</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#53-idfa">5.3 创建带有广告标识符（IDFA）身份的客户</a></li>
                      </ul>
                    
                  
                    <li class=""><a href="#6">6. 跟踪客户事件</a></li>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#61">6.1 跟踪预置客户事件</a></li>
                      </ul>
                    
                      <ul class="nav nav-l2">
                        <li><a class="itm-l2" href="#62">6.2 跟踪自定义客户事件</a></li>
                      </ul>
                    
                  
                    <li class=""><a href="#7">7. 技术支持</a></li>
                    
                  
                  </ul>
                
              </li>

          

              <li class="">
                <a class="itm-l1" href="../androidcollection/">通过ANDROID SDK进行数据采集</a>
                
              </li>

          
        
      

    
    </ul>
</div></div>
        <div class="col-md-9 content-body" role="main">
             

<h1>通过IOS SDK进行数据采集</h1>

<h1 id="ios-sdk">iOS SDK 开发指南</h1>
<h1 id="1">1. 使用说明</h1>
<ul>
<li>本文是 DMHub iOS SDK 标准的开发指南文档，用以指导 SDK 的集成和使用，默认读者已经具备一定的 iOS 开发能力。</li>
<li>本篇指南匹配的 DMHub iOS SDK 版本为： <code>v0.1.0</code> 。</li>
<li>DMHub iOS SDK 0.1.0 要求  <code>iOS &gt;= 6.0</code> 。</li>
</ul>
<h1 id="2">2. 开发准备</h1>
<h3 id="21">2.1 创建应用</h3>
<p>集成 DMHub SDK 之前，您首先需要到 DM Hub 平台创建应用。</p>
<h4 id="211">2.1.1 进入应用设置页面</h4>
<p>点击 DM Hub 平台首页右上角的齿轮图标，选择 <code>开放与集成</code> 选项，进入应用设置页面。</p>
<p><img alt="left | 0x0" src="../../../resources/ios.png" /></p>
<h4 id="212">2.1.2 新建应用</h4>
<p>在应用设置页面点击右上角的 <code>+ 新建</code> 按钮，在弹出的创建应用弹出框中填写应用名称和描述后保存。</p>
<p><img alt="left | 0x0" src="../../../resources/ios1.png" /></p>
<h4 id="213">2.1.3 更新权限设置</h4>
<p>创建应用成功之后，即可获得集成 SDK 所需的 appid 和 secret 信息。根据开发需求进行权限设置后，点击右下角的 <code>更新</code> 按钮（注：即使没有更改权限设置，也要进行更新），完成应用创建。</p>
<p><img alt="left | 0x0" src="../../../resources/ios2.png" /></p>
<h3 id="22">2.2 工程准备</h3>
<p>集成 <code>极光推送</code> 或 <code>个推推送</code> 。</p>
<h1 id="3-sdk">3. 导入 SDK</h1>
<h3 id="31-sdk">3.1 添加 SDK 文件</h3>
<p>在 Xcode 中选择 <code>File</code> ---&gt; <code>Add Files to “YOUR_PROJECT_NAME”...</code> ，将 libs 目录下的 DMHubSDK.h 头文件和 dmhubsdk-ios-x.x.x.a 静态库文件添加到工程目录中。</p>
<h3 id="32">3.2 添加系统库支持</h3>
<p>在 <code>TARGETS</code> ---&gt; <code>General</code> ---&gt; <code>Linked Frameworks and Libraries</code> 下，添加以下系统库支持：</p>
<pre><code class="tex">UIKit.framework
Foundation.framework
SystemConfiguration.framework
libsqlite3.tbd
AdSupport.framework （如果不使用 IDFA，则不需要添加该系统库）
</code></pre>

<h3 id="33">3.3 检查静态库文件路径</h3>
<p>检查 <code>TARGETS</code> ---&gt; <code>Build Settings</code> ---&gt; <code>Search Paths</code> 下的 <code>Library Search Paths</code> 。一般情况下，添加 dmhubsdk-ios-x.x.x.a 静态库文件时，Xcode 会自动在 <code>Library Search Paths</code> 中添加 <code>$(PROJECT_DIR)/{静态库文件所在相对目录}</code> ，如果没有，请手动添加。</p>
<h3 id="34">3.4 引入头文件</h3>
<p>在需要使用 DMHubSDK 功能的文件中引入头文件：</p>
<pre><code class="objectivec">#import &quot;DMHubSDK.h&quot;
</code></pre>

<h1 id="4-sdk">4. 配置 SDK 相关参数</h1>
<p>右键单击 Info.plist 文件，<code>Open As</code> ---&gt; <code>Source Code</code> ，配置 SDK 所需参数：</p>
<pre><code class="xml">&lt;key&gt;DMHubSDKAppId&lt;/key&gt;
&lt;string&gt;在 DM Hub 平台获得的 appid&lt;/string&gt;

&lt;key&gt;DMHubSDKSecret&lt;/key&gt;
&lt;string&gt;在 DM Hub 平台获得的 secret&lt;/string&gt;

&lt;!--
    您所采用的推送平台，支持极光和个推。
    如果您采用极光推送，请填写 'jpush'(默认，可以不配置)；
    如果您采用个推推送，请填写 'getui'；
    如果您同时采用极光推送和个推推送，请填写 'jpush&amp;amp;getui'。
--&gt;
&lt;key&gt;DMHubPushChannel&lt;/key&gt;
&lt;string&gt;采用的推送平台&lt;/string&gt;
</code></pre>

<p>如果您是在测试账号下创建的应用，则需要设置支持 Http 传输，并配置 <code>DMHubServer</code> 参数：</p>
<pre><code class="xml">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;
    &lt;true/&gt;
&lt;/dict&gt;

&lt;key&gt;DMHubServer&lt;/key&gt;
&lt;string&gt;http://api.convertwork.cn&lt;/string&gt;
</code></pre>

<h1 id="5">5. 创建客户和客户身份</h1>
<p>为了跟踪客户事件，需要先创建客户和客户身份，DMHubSDK 提供了以下三个 API 来创建客户和客户身份，请开发者根据项目需求调用。</p>
<p>以下三个 API ，如果重复调用并传入相同参数，则不会重复进行处理；如果客户已经存在，则不会重复创建客户，而只是将传入的身份信息与客户绑定；创建客户和客户身份的 API 与跟踪客户事件的 API 在调用上不需要区分先后顺序，SDK 内部会进行处理。</p>
<h3 id="51-jpush">5.1 创建带有 JPush 身份的客户</h3>
<p>如果您采用了极光推送，请在 <code>AppDelegate.m</code> 文件中调用此 API 创建带有 JPush 身份的客户。</p>
<ul>
<li>接口定义</li>
</ul>
<pre><code class="objectivec">/**
 添加客户的 JPush 身份信息

 @param jPushAppKey JPush 的 AppKey
 @param jPushId     JPush SDK 向 JPush Server 注册得到的注册 Id
 */
- (void)fetchJPushAppKey:(NSString *_Nonnull)jPushAppKey
                 jPushId:(NSString *_Nonnull)jPushId;
</code></pre>

<ul>
<li>代码示例</li>
</ul>
<pre><code class="objectivec">// AppDelegate.m

@implementation AppDelegate

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    [JPUSHService registrationIDCompletionHandler:^(int resCode, NSString *registrationID) {
        // 添加客户的 JPush 身份信息
        [[DMHubSDK shared] fetchJPushAppKey:@&quot;JPush 的 AppKey&quot; jPushId:registrationID];
    }];
}

@end
</code></pre>

<h3 id="52-getui">5.2 创建带有 GeTui 身份的客户</h3>
<p>如果您采用了个推推送，请在 <code>AppDelegate.m</code> 文件中调用此 API 创建带有 GeTui 身份的客户。</p>
<ul>
<li>接口定义</li>
</ul>
<pre><code class="objectivec">/**
 添加客户的 GeTui 身份信息

 @param geTuiAppKey GeTui 的 AppKey
 @param geTuiId     GeTui SDK 向 GeTui Server 注册得到的 clientId
 */
- (void)fetchGeTuiAppKey:(NSString *_Nonnull)geTuiAppKey
                 geTuiId:(NSString *_Nonnull)geTuiId;
</code></pre>

<ul>
<li>代码示例</li>
</ul>
<pre><code class="objectivec">// GeTuiSdkDelegate 的回调方法
- (void)GeTuiSdkDidRegisterClient:(NSString *)clientId {
    // 添加客户的 GeTui 身份信息
    [[DMHubSDK shared] fetchGeTuiAppKey:@&quot;GeTui 的 AppKey&quot; geTuiId:clientId];
}
</code></pre>

<h3 id="53-idfa">5.3 创建带有广告标识符（IDFA）身份的客户</h3>
<p>如果需要上传 IDFA 作为客户身份，请在 <code>AppDelegate.m</code> 文件中调用此 API 创建带有广告标识符（IDFA）身份的客户。</p>
<ul>
<li>接口定义</li>
</ul>
<pre><code class="objectivec">/**
 添加客户的广告标识符（IDFA）信息

 如果不需要使用 IDFA，请不要调用此方法。调用此方法后，IDFA 将会添加为客户的一个身份

 @param advertisingIdentifier 广告标识符（IDFA）
 */
- (void)fetchIdfa:(NSString *_Nonnull)advertisingIdentifier;
</code></pre>

<ul>
<li>代码示例</li>
</ul>
<pre><code class="objectivec">// AppDelegate.m
// 导入 IDFA 功能所需头文件
#import &lt;AdSupport/AdSupport.h&gt;

@implementation AppDelegate

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    // 获取 IDFA
    NSString *idfa = [[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString];
    // 添加客户的广告标识符（IDFA）信息
    [[DMHubSDK shared] fetchIdfa:idfa];
}

@end
</code></pre>

<h1 id="6">6. 跟踪客户事件</h1>
<p>DMHubSDK 提供了以下 API 来跟踪客户事件，请开发者根据项目需求调用。</p>
<p>DM Hub 平台预置了 4 个客户事件：<code>打开手机应用</code> 、<code>进入手机视图</code>、<code>收到手机应用通知</code>、<code>点击手机应用通知</code>。</p>
<p>对于 DM Hub 平台预置事件，DMHubSDK 会默认跟踪 <code>打开手机应用</code> 事件，其余三个预置事件需要由开发者自行调用 SDK 提供的 API，并根据接口定义传入正确参数；对于推送通知相关事件，SDK 只会对由 DM Hub 平台发出的推送通知引发的客户事件进行记录。</p>
<p>对于自定义事件，需要先在 DM Hub 后台新建自定义事件，在新建自定义事件时，还可以根据业务需要添加自定义属性。在调用跟踪客户自定义事件的 API 时，可以传入自定义属性。</p>
<p>对于离线状态下产生的客户事件，SDK 会先存储到本地，当检测到有网络连接时再发送给 DM Hub 平台。</p>
<h3 id="61">6.1 跟踪预置客户事件</h3>
<h4 id="611">6.1.1 跟踪进入视图事件</h4>
<ul>
<li>接口定义</li>
</ul>
<pre><code class="objectivec">/**
 跟踪进入视图事件

 @param viewName 视图的名称，客户时间轴上的显示为：'进入手机视图 ${viewName}'
 */
- (void)trackOpenView:(NSString *_Nonnull)viewName;
</code></pre>

<ul>
<li>代码示例</li>
</ul>
<pre><code class="objectivec">@implementation ViewController

- (void)viewDidAppear:(BOOL)animated {
    [super viewDidAppear:animated];

    // 跟踪进入视图事件
    [[DMHubSDK shared] trackOpenView:@&quot;{viewName}&quot;];
}

@end
</code></pre>

<h4 id="612">6.1.2 跟踪推送通知事件</h4>
<ul>
<li>接口定义</li>
</ul>
<pre><code class="objectivec">/**
 跟踪收到推送通知事件

 @param userInfo 推送通知中的 userInfo
 @return 如果传入的 userInfo 对应的推送通知来自 DM Hub 平台，返回 YES；否则，返回 NO
 */
- (BOOL)trackReceiveNotification:(NSDictionary *_Nonnull)userInfo;

/**
 跟踪点击推送通知事件

 @param userInfo 推送通知中的 userInfo
 @return 如果传入的 userInfo 对应的推送通知来自 DM Hub 平台，返回 YES；否则，返回 NO
 */
- (BOOL)trackClickNotification:(NSDictionary *_Nonnull)userInfo;
</code></pre>

<ul>
<li>代码示例</li>
</ul>
<pre><code class="objectivec">// 在收到推送通知和点击推送通知的回调方法中进行调用，由于不同的系统版本、不同的推送平台等因素会导致回调方法也不同，因此此处仅示例在部分回调方法中如何进行调用
@implementation AppDelegate

// iOS 7 及以上系统收到通知的回调
- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler {
    // 跟踪收到推送通知事件
    [[DMHubSDK shared] trackReceiveNotification:userInfo];
}

// iOS 6 及以下系统受到通知的回调
- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo {
    // 跟踪收到推送通知事件
    [[DMHubSDK shared] trackReceiveNotification:userInfo];
}

#ifdef NSFoundationVersionNumber_iOS_9_x_Max
#pragma mark - JPUSHRegisterDelegate
- (void)jpushNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(void (^)(NSInteger))completionHandler {
    NSDictionary *userInfo = notification.request.content.userInfo;
    // 跟踪收到推送通知事件
    [[DMHubSDK shared] trackReceiveNotification:userInfo];
}

- (void)jpushNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void (^)())completionHandler {
    NSDictionary *userInfo = response.notification.request.content.userInfo;
    // 跟踪点击推送通知事件
    [[DMHubSDK shared] trackClickNotification:userInfo];
}
#endif

#if __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= __IPHONE_10_0
- (void)userNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(void (^)(UNNotificationPresentationOptions))completionHandler {
    NSDictionary *userInfo = notification.request.content.userInfo;
    // 跟踪收到推送通知事件
    [[DMHubSDK shared] trackReceiveNotification:userInfo];
}

- (void)userNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void (^)())completionHandler {
    NSDictionary *userInfo = response.notification.request.content.userInfo;
    // 跟踪点击推送通知事件
    [[DMHubSDK shared] trackClickNotification:userInfo];
}
#endif

@end
</code></pre>

<h4 id="613-jpush">6.1.3 跟踪收到 JPush 自定义消息事件</h4>
<ul>
<li>接口定义</li>
</ul>
<pre><code class="objectivec">/**
 跟踪收到 JPush 自定义消息事件

 @param notification JPush 收到自定义消息的回调方法中传入的 notification
 @return 如果传入的 notification 对应的 JPush 自定义消息来自 DM Hub 平台，返回 YES；否则，返回 NO
 */
- (BOOL)trackReceiveJPushMessage:(NSNotification *_Nonnull)notification;
</code></pre>

<ul>
<li>代码示例</li>
</ul>
<pre><code class="objectivec">- (void)didReceiveJPushMessage:(NSNotification *)notification {
    [[DMHubSDK shared] trackReceiveJPushMessage:notification];
}
</code></pre>

<h4 id="614-getui">6.1.4 跟踪收到 GeTui 透传消息事件</h4>
<ul>
<li>接口定义</li>
</ul>
<pre><code class="objectivec">/**
 跟踪收到 GeTui 透传消息事件

 @param payloadData GeTui 收到透传消息的回调方法中传入的 payloadData
 @param offLine GeTui 收到透传消息的回调方法中传入的 offLine
 @return 如果传入的 payloadData 对应的 GeTui 透传消息来自 DM Hub 平台，返回 YES；否则，返回 NO
 */
- (BOOL)trackReceiveGeTuiPayloadData:(NSData *_Nonnull)payloadData
                             offLine:(BOOL)offLine;
</code></pre>

<ul>
<li>代码示例</li>
</ul>
<pre><code class="objectivec">- (void)GeTuiSdkDidReceivePayloadData:(NSData *)payloadData andTaskId:(NSString *)taskId andMsgId:(NSString *)msgId andOffLine:(BOOL)offLine fromGtAppId:(NSString *)appId {
    [[DMHubSDK shared] trackReceiveGeTuiPayloadData:payloadData offLine:offLine];
}
</code></pre>

<h3 id="62">6.2 跟踪自定义客户事件</h3>
<p>在 DM Hub 后台新建的自定义事件，可以通过调用此 API 进行跟踪。</p>
<pre><code class="objectivec">/**
 跟踪自定义客户事件

 @param eventId    与 DM Hub 中新建的自定义事件对应的事件 Id
 @param targetName 对于自定义事件，客户时间轴上只会显示 targetName，相当于事件标题
 @param targetId   客户触发该事件对应的目标(如按钮)的 Id
 @param properties 事件的自定义属性，必须以在 DM Hub 中新建自定义事件时添加的自定义属性作为 key
 */
typedef NSDictionary&lt;NSString *, NSString *&gt; * Properties;
- (void)trackWithEventId:(NSString *_Nonnull)eventId
              targetName:(NSString *_Nonnull)targetName
                targetId:(NSString *_Nullable)targetId
              properties:(Properties _Nullable)properties;
</code></pre>

<h1 id="7">7. 技术支持</h1>
<ul>
<li>在线客服：在 DM Hub 平台右下角进行客服咨询</li>
<li>电子邮件：<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#99;&#111;&#110;&#118;&#101;&#114;&#116;&#108;&#97;&#98;&#46;&#99;&#111;&#109;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#99;&#111;&#110;&#118;&#101;&#114;&#116;&#108;&#97;&#98;&#46;&#99;&#111;&#109;</a></li>
</ul>
            <div class="ds-thread" data-thread-key="通过IOS SDK进行数据采集" data-title="通过IOS SDK进行数据采集" data-url=""></div>
        </div>
        
    </div>
    
    </script>
</body>

</html>